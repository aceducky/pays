import{c as N,h as g,i as A,U as j,f as S,l as v,u as _,t as u,j as t,n as p,L as M}from"./index-DlYCf7u7.js";import{u as E,a as L,T as h}from"./TextField-gRpCMCcI.js";import{P}from"./usePaymentsQuery-Dzm29qM7.js";import{z as i,c as U,C as D}from"./user.zodSchema-BeGEfuyb.js";import{c as w}from"./createLucideIcon-DjPmYKkK.js";const O=[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]],T=w("arrow-left",O);function F(){const e=N.c(6),r=g();let s;e[0]!==r?(s={mutationFn:k,onSuccess:()=>{r.invalidateQueries({queryKey:P(),exact:!1}),r.invalidateQueries({queryKey:j})}},e[0]=r,e[1]=s):s=e[1];const n=A(s);let a;return e[2]!==n.error||e[3]!==n.isPending||e[4]!==n.mutateAsync?(a={paymentMutationAsync:n.mutateAsync,isPending:n.isPending,paymentError:n.error},e[2]=n.error,e[3]=n.isPending,e[4]=n.mutateAsync,e[5]=a):a=e[5],a}async function k(e){return(await S.post("/payments",e)).data}const C=new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:2,maximumFractionDigits:2}),x=e=>C.format(e),o={MIN_ALLOWED_AMOUNT:1,MAX_ALLOWED_AMOUNT:1e6},W=i.string().trim().refine(e=>{if(e.split(".")[1]?.length>2)return!1;const s=Number(e);return!isNaN(s)&&s>=o.MIN_ALLOWED_AMOUNT&&s<=o.MAX_ALLOWED_AMOUNT},{error:`Amount must be a positive number with at most 2 decimal places and must be between ${x(o.MIN_ALLOWED_AMOUNT)} and ${x(o.MAX_ALLOWED_AMOUNT)}`}),z=i.string().trim().max(255,"Description is optional and cannot be more than 255 characters").optional(),I=i.object({receiverUserName:U,amountStr:W,description:z});function $(){"use no memo";const e=v(),r=_(),s=e.state?.receiverUserName,{paymentMutationAsync:n,isPending:a,paymentError:c}=F(),{register:l,handleSubmit:f,formState:{errors:m}}=E({resolver:L(I),defaultValues:{receiverUserName:s,amountStr:"",description:""},mode:"onTouched",reValidateMode:"onChange"});if(!s)return u.error("Please select a user from search first"),r("/dashboard"),null;const y=async d=>{try{await n({receiverUserName:s,amountStr:d.amountStr,description:d.description}),u.success("Payment sent successfully!"),r("/dashboard")}catch(b){console.error(p(b))}};return t.jsx("main",{className:"h-full flex items-center justify-center bg-base-100",children:t.jsxs("div",{className:"w-full max-w-md bg-base-200 rounded-2xl shadow-lg p-6 flex flex-col justify-center items-center",children:[t.jsxs("div",{className:"flex items-center gap-3 mb-6 self-start",children:[t.jsx("button",{onClick:()=>r(-1),disabled:a,className:"p-2 rounded-full hover:bg-base-300 transition",children:t.jsx(T,{size:20})}),t.jsx("h2",{className:"text-2xl font-semibold",children:"Send Payment"})]}),t.jsxs("div",{className:"bg-base-300 rounded-lg p-3 mb-5 self-start",children:[t.jsx("div",{className:"text-sm text-base-content/70",children:"Sending to:"}),t.jsxs("div",{className:"font-bold text-lg",children:["@",s]})]}),t.jsxs("form",{onSubmit:f(y),className:"flex flex-col gap-4",children:[t.jsx("div",{children:t.jsx(h,{label:"Amount $",name:"amountStr",type:"text",hint:"Enter the amount to send",error:m.amountStr,placeholder:"1.00",disabled:a,registration:l("amountStr")})}),t.jsx("div",{children:t.jsx(h,{label:"Description (optional)",name:"description",type:"text",hint:"Add a short note",error:m.description,placeholder:"For dinner, tickets, etc.",disabled:a,registration:l("description")})}),c&&t.jsxs("div",{className:"alert alert-error flex items-center gap-2",children:[t.jsx(D,{size:18}),t.jsx("span",{children:p(c)})]}),t.jsx("button",{type:"submit",disabled:a,className:"btn btn-accent w-full py-3 mt-4 text-lg font-semibold hover:shadow-lg transition",children:a?"Processing...":"Send Payment"})]}),t.jsx("div",{className:"text-center text-sm mt-4",children:t.jsx(M,{className:"underline opacity-70 hover:text-accent hover:opacity-100 ",to:"/dashboard",children:"Back to Dashboard"})})]})})}export{$ as default};
