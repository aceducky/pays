import{c as C,h as v,i as S,n as E,U as A,f as M,a as _,k as R,j as e,t as w}from"./index-jBZXzTaY.js";import{u as x,a as p,T}from"./TextField-DtNKcj4b.js";import{C as N,b as V,p as z}from"./user.zodSchema-BkAi3_U6.js";import{P as b}from"./PasswordField-CEUIbzrH.js";import"./createLucideIcon-COlrP71D.js";function Q(){const s=C.c(9),n=v();let r;s[0]===Symbol.for("react.memo_cache_sentinel")?(r=["change-fullname"],s[0]=r):r=s[0];let t;s[1]!==n?(t={mutationKey:r,mutationFn:U,onSuccess:h=>{const u=h.data?.fullName;u&&n.setQueryData(A,m=>m&&{...m,fullName:u})}},s[1]=n,s[2]=t):t=s[2];const a=S(t),o=a.mutateAsync,c=a.isPending;let l;s[3]!==a.error?(l=E(a.error),s[3]=a.error,s[4]=l):l=s[4];let i;return s[5]!==a.isPending||s[6]!==a.mutateAsync||s[7]!==l?(i={changeFullNameAsync:o,isChangingFullName:c,changeFullNameError:l},s[5]=a.isPending,s[6]=a.mutateAsync,s[7]=l,s[8]=i):i=s[8],i}async function U(s){return(await M.patch("/user/fullName",s)).data}function O(){"use no memo";const{user:s}=_(),{changeFullNameAsync:n,isChangingFullName:r,changeFullNameError:t}=Q(),{passwordMutationAsync:a,isChangingPassword:o,passwordError:c}=R(),{register:l,handleSubmit:i,formState:{errors:h},reset:u}=x({resolver:p(V),defaultValues:{fullName:s?.fullName??""},mode:"onTouched",reValidateMode:"onChange"}),{register:m,handleSubmit:j,formState:{errors:g},reset:P}=x({resolver:p(z),defaultValues:{oldPassword:"",newPassword:""},mode:"onTouched",reValidateMode:"onChange"}),y=async d=>{try{const f=await n({fullName:d.fullName});u({fullName:d.fullName}),w.success(f.message)}catch{console.log("Failed updating full name")}},F=async d=>{try{const f=await a({oldPassword:d.oldPassword,newPassword:d.newPassword});P({oldPassword:"",newPassword:""}),w.success(f.message)}catch{console.log("Failed changing password")}};return e.jsx("main",{className:"h-full flex items-center justify-center bg-base-100",children:e.jsxs("div",{className:"w-full max-w-md bg-base-200 rounded-2xl shadow-lg p-6 flex flex-col justify-center items-center",children:[e.jsx("div",{className:"flex items-center gap-3 mb-6 self-start",children:e.jsx("h2",{className:"text-2xl font-semibold",children:"Profile"})}),e.jsxs("div",{className:"w-full mb-6",children:[e.jsx("h3",{className:"text-lg font-medium mb-3",children:"Change full name"}),e.jsxs("form",{onSubmit:i(y),className:"flex flex-col gap-4",children:[e.jsx("div",{children:e.jsx(T,{label:"Full name",name:"fullName",type:"text",hint:"Your display name",error:h.fullName,placeholder:"Full name",disabled:r||o,registration:l("fullName")})}),t&&e.jsxs("div",{className:"alert alert-error flex items-center gap-2",children:[e.jsx(N,{size:18}),e.jsx("span",{children:t})]}),e.jsx("button",{type:"submit",disabled:r||o,className:"btn btn-primary w-full py-3 text-lg font-semibold hover:shadow-lg transition",children:r?"Updating...":"Update name"})]})]}),e.jsx("div",{className:"divider m-2"}),e.jsxs("div",{className:"w-full mb-2",children:[e.jsx("h3",{className:"text-lg font-medium mb-3",children:"Change password"}),e.jsxs("form",{onSubmit:j(F),className:"flex flex-col gap-4",children:[e.jsx("div",{children:e.jsx(b,{label:"Old password",name:"oldPassword",hint:"Enter your current password",error:g.oldPassword,registration:m("oldPassword")})}),e.jsx("div",{children:e.jsx(b,{label:"New password",name:"newPassword",hint:"Choose a strong password",error:g.newPassword,registration:m("newPassword")})}),c&&e.jsxs("div",{className:"alert alert-error flex items-center gap-2",children:[e.jsx(N,{size:18}),e.jsx("span",{children:c})]}),e.jsx("button",{type:"submit",disabled:o||r,className:"btn btn-primary w-full py-3 text-lg font-semibold hover:shadow-lg transition",children:o?"Processing...":"Change password"})]})]})]})})}export{O as default};
